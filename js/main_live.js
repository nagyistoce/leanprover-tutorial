function gup(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),o=n.exec(window.location.href);return null==o?"":o[1]}function elapsed_time_string(e){var t=(new Date).getTime();return(t-e)/1e3+"sec"}!function(e){"use strict";e.fn.fitVids=function(t){var n={customSelector:null,ignore:null};if(!document.getElementById("fit-vids-style")){var o=document.head||document.getElementsByTagName("head")[0],i=".fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}",a=document.createElement("div");a.innerHTML='<p>x</p><style id="fit-vids-style">'+i+"</style>",o.appendChild(a.childNodes[1])}return t&&e.extend(n,t),this.each(function(){var t=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']","iframe[src*='kickstarter.com'][src*='video.html']","object","embed"];n.customSelector&&t.push(n.customSelector);var o=".fitvidsignore";n.ignore&&(o=o+", "+n.ignore);var i=e(this).find(t.join(","));i=i.not("object object"),i=i.not(o),i.each(function(){var t=e(this);if(!(t.parents(o).length>0||"embed"===this.tagName.toLowerCase()&&t.parent("object").length||t.parent(".fluid-width-video-wrapper").length)){t.css("height")||t.css("width")||!isNaN(t.attr("height"))&&!isNaN(t.attr("width"))||(t.attr("height",9),t.attr("width",16));var n="object"===this.tagName.toLowerCase()||t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),i=isNaN(parseInt(t.attr("width"),10))?t.width():parseInt(t.attr("width"),10),a=n/i;if(!t.attr("id")){var l="fitvid"+Math.floor(999999*Math.random());t.attr("id",l)}t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*a+"%"),t.removeAttr("height").removeAttr("width")}})})}}(window.jQuery||window.Zepto),function(e){var t=e(window);e.fn.visible=function(e,n,o){if(!(this.length<1)){var i=this.length>1?this.eq(0):this,a=i.get(0),l=t.width(),r=t.height(),o=o?o:"both",s=n===!0?a.offsetWidth*a.offsetHeight:!0;if("function"==typeof a.getBoundingClientRect){var u=a.getBoundingClientRect(),d=u.top>=0&&u.top<r,c=u.bottom>0&&u.bottom<=r,h=u.left>=0&&u.left<l,m=u.right>0&&u.right<=l,_=e?d||c:d&&c,f=e?h||h:h&&m;if("both"===o)return s&&_&&f;if("vertical"===o)return s&&_;if("horizontal"===o)return s&&f}else{var p=t.scrollTop(),g=p+r,b=t.scrollLeft(),w=b+l,v=i.offset(),y=v.top,M=y+i.height(),x=v.left,$=x+i.width(),k=e===!0?M:y,C=e===!0?y:M,T=e===!0?$:x,S=e===!0?x:$;if("both"===o)return!!s&&g>=C&&k>=p&&w>=S&&T>=b;if("vertical"===o)return!!s&&g>=C&&k>=p;if("horizontal"===o)return!!s&&w>=S&&T>=b}}}}(jQuery),function(e){e.fn.smoothScroller=function(t){t=e.extend({},e.fn.smoothScroller.defaults,t);var n=e(this);return e(t.scrollEl).animate({scrollTop:n.offset().top-e(t.scrollEl).position().top-t.offset},t.speed,t.ease,function(){var e=n.attr("id");e.length&&(history.pushState?history.pushState(null,null,"#"+e):document.location.hash=e),n.trigger("smoothScrollerComplete")}),this},e.fn.smoothScroller.defaults={speed:400,ease:"swing",scrollEl:"body",offset:0},e("body").on("click","[data-smoothscroller]",function(t){t.preventDefault();var n=e(this).attr("href");0===n.indexOf("#")&&e(n).smoothScroller()})}(jQuery),function(e){var t={};e.fn.toc=function(t){var n,o=this,i=e.extend({},jQuery.fn.toc.defaults,t),a=e(i.container),l=e(i.selectors,a),r=[],s=i.activeClass,u=function(t,n){if(i.smoothScrolling&&"function"==typeof i.smoothScrolling){t.preventDefault();var a=e(t.target).attr("href");i.smoothScrolling(a,i,n)}e("li",o).removeClass(s),e(t.target).parent().addClass(s)},d=function(){n&&clearTimeout(n),n=setTimeout(function(){for(var t,n=e(window).scrollTop(),a=Number.MAX_VALUE,l=0,u=0,d=r.length;d>u;u++){var c=Math.abs(r[u]-n);a>c&&(l=u,a=c)}e("li",o).removeClass(s),t=e("li:eq("+l+")",o).addClass(s),i.onHighlight(t)},50)};return i.highlightOnScroll&&(e(window).bind("scroll",d),d()),this.each(function(){var t=e(this),n=e(i.listType);l.each(function(o,a){var l=e(a);r.push(l.offset().top-i.highlightOffset);var s=i.anchorName(o,a,i.prefix);a.id!==s&&e("<span/>").attr("id",s).insertBefore(l);var c=e("<a/>").text(i.headerText(o,a,l)).attr("href","#"+s).bind("click",function(n){e(window).unbind("scroll",d),u(n,function(){e(window).bind("scroll",d)}),t.trigger("selected",e(this).attr("href"))}),h=e("<li/>").addClass(i.itemClass(o,a,l,i.prefix)).append(c);n.append(h)}),t.html(n)})},jQuery.fn.toc.defaults={container:"body",listType:"<ul/>",selectors:"h1,h2,h3",smoothScrolling:function(t,n,o){e(t).smoothScroller({offset:n.scrollToOffset}).on("smoothScrollerComplete",function(){o()})},scrollToOffset:0,prefix:"toc",activeClass:"toc-active",onHighlight:function(){},highlightOnScroll:!0,highlightOffset:100,anchorName:function(n,o,i){if(o.id.length)return o.id;var a=e(o).text().replace(/[^a-z0-9]/gi," ").replace(/\s+/g,"-").toLowerCase();if(t[a]){for(var l=2;t[a+l];)l++;a=a+"-"+l}return t[a]=!0,i+"-"+a},headerText:function(e,t,n){return n.text()},itemClass:function(e,t,n,o){return o+"-"+n[0].tagName.toLowerCase()}}}(jQuery),$(document).ready(function(){$(".js-menu-trigger").on("click touchstart",function(e){$("body").toggleClass("no-scroll"),$(".js-menu, .js-menu-screen").toggleClass("is-visible"),$(".sliding-menu-button").toggleClass("slide close"),$("#masthead, #page-wrapper").toggleClass("slide"),e.preventDefault()}),$(".js-menu-screen").on("click touchstart",function(e){$("body").toggleClass("no-scroll"),$(".js-menu, .js-menu-screen").toggleClass("is-visible"),$(".sliding-menu-button").toggleClass("slide close"),$("#masthead, #page-wrapper").toggleClass("slide"),e.preventDefault()})}),$(document).ready(function(){$("#main").fitVids()}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}),"https:"!=window.location.protocol&&window.location.hostname.indexOf("lean")>=0&&(window.location.href.startsWith("http://localhost")||(window.location.href="https:"+window.location.href.substring(window.location.protocol.length)));var myModule=function(){var e="kl2l16uaul9rwpe",t="Dropbox/Apps/Lean.JS/",n=new Dropbox.Client({key:e}),o=ace.require("ace/autocomplete/util"),i=ace.require("ace/ext/language_tools"),a=ace.edit("editor_main");a.$blockScrolling=1/0;var l=ace.require("ace/range").Range,r=ace.edit("editor_console");r.$blockScrolling=1/0;var s=location.search.match("(\\?|&)live")?!0:!1,u=s?0:.5,d=window.innerWidth>window.innerHeight?s?.5:.8:.5,c=40,h=10,m="ace/theme/subatomic",_=[],f="input.lean",p=gup("code"),g=gup("url");return{editor_main:a,editor_console:r,push_output_buffer:function(e){_.push(e)},init_editor_main:function(){a.session.setNewLineMode("unix"),a.setTheme(m),a.getSession().setMode("ace/mode/lean"),a.setShowPrintMargin(!1),a.setOption("scrollPastEnd",.7),a.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!1,enableSnippets:!0}),a.resize(),a.on("change",function(){var e=a.session.getAnnotations(),t=e.filter(function(e){return e.row<a.selection.getCursor().row});myModule.editor_main.session.setAnnotations(t)})},init_editor_console:function(){r.session.setNewLineMode("unix"),r.setTheme(m),r.setShowPrintMargin(!1),r.setOption("scrollPastEnd",.7),r.setReadOnly(!0),r.getSession().setUseWrapMode(!1),r.renderer.setShowGutter(!1),r.resize()},get_dropbox_client:function(){return n},get_main_console_ratio:function(){return d},set_main_console_ratio:function(e){d=e},resize_editors:function(){var e,t,n,o,i,l,m,_,f,p,g,b,w=window.innerHeight,v=window.innerWidth;s?v>=w?(i=0,e=Math.floor(v*d),n=v-e-h,l=0,t=w-c,o=t,g=c,main_handle_top=c,m=c,f=m,sub_handle_top=m,b=0,main_handle_left=0,_=0,sub_handle_left=e,p=e+h,main_handle_background_image="url(css/images/handle-h.png)",main_handle_cursor="row-resize",sub_handle_background_image="url(css/images/handle-v.png)",sub_handle_cursor="col-resize",main_handle_width=2,main_handle_height=2,sub_handle_width=h,sub_handle_height=o):(i=0,l=0,e=v,t=Math.floor((w-c)*d),n=e,o=w-t-h,g=0,b=0,main_handle_top=c,main_handle_left=0,m=c,_=0,sub_handle_top=m+t,sub_handle_left=_,f=m+t+h,p=_,main_handle_background_image="url(css/images/handle-v.png)",main_handle_cursor="col-resize",sub_handle_background_image="url(css/images/handle-h.png)",sub_handle_cursor="row-resize",main_handle_width=2,main_handle_height=2,sub_handle_width=n,sub_handle_height=h):v>=w?(i=Math.floor(v*u),e=v-i-h,n=e,l=w-c,t=Math.floor(l*d),o=l-t-h,g=c,main_handle_top=c,m=g,sub_handle_top=m+t,f=m+t+h,b=0,main_handle_left=i,_=i+h,sub_handle_left=_,p=_,main_handle_background_image="url(css/images/handle-v.png)",main_handle_cursor="col-resize",sub_handle_background_image="url(css/images/handle-h.png)",sub_handle_cursor="row-resize",main_handle_width=h,main_handle_height=l,sub_handle_width=n,sub_handle_height=h):(i=v,e=Math.floor(v*d),n=v-e-h,l=Math.floor((w-c)*u),t=w-c-l-h,o=t,g=c,main_handle_top=g+l,m=g+l+h,f=m,sub_handle_top=m,b=0,main_handle_left=0,_=0,sub_handle_left=e,p=e+h,main_handle_background_image="url(css/images/handle-h.png)",main_handle_cursor="row-resize",sub_handle_background_image="url(css/images/handle-v.png)",sub_handle_cursor="col-resize",main_handle_width=i,main_handle_height=h,sub_handle_width=h,sub_handle_height=o),main_handle_width-=2,main_handle_height-=2,sub_handle_width-=2,sub_handle_height-=2,$("#editor_console").css({position:"absolute",top:f,left:p,width:n,height:o}),$("#editor_main").css({position:"absolute",top:m,left:_,width:e,height:t}),$("#resizable_handle_main").css({position:"absolute",top:main_handle_top,left:main_handle_left,width:main_handle_width,height:main_handle_height,"background-image":main_handle_background_image,"background-repeat":"no-repeat",cursor:main_handle_cursor,"background-position":"center",border:"solid 1px #cccccc"}),$("#resizable_handle_sub").css({position:"absolute",top:sub_handle_top,left:sub_handle_left,width:sub_handle_width,height:sub_handle_height,"background-image":sub_handle_background_image,"background-repeat":"no-repeat",cursor:sub_handle_cursor,"background-position":"center",border:"solid 1px #cccccc"}),a.resize(),r.resize(),$("#tutorial_contents").css({position:"absolute",top:g,left:b,width:i,height:l})},init_editor_keybindings:function(){var e={name:"run_lean",bindKey:{win:"shift-enter",mac:"shift-enter",sender:"editor|cli"},exec:function(e,t,n){myModule.process_main_buffer()}};a.commands.addCommand(e),r.commands.addCommand(e)},init_resizable:function(){$("#resizable_handle_main").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){var t=window.innerHeight,n=window.innerWidth;if(n>=t){var o=Math.min(n,e.clientX);u=o/n}else{var i=Math.max(c,Math.min(e.clientY,t));u=(i-c)/(t-c)}myModule.resize_editors()})}),$("#resizable_handle_sub").mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){var t=window.innerHeight,n=window.innerWidth;if(s)if(n>=t){var o=Math.min(n,e.pageX);d=o/n}else{var i=Math.max(c,Math.min(e.pageY,t));d=(i-c)/(t-c)}else if(n>=t){var i=Math.max(c,Math.min(e.pageY,t));d=(i-c)/(t-c)}else{var o=Math.min(n,e.pageX);d=o/n}myModule.resize_editors()})}),$(document).mouseup(function(e){$(document).unbind("mousemove")})},init_autocomplete:function(){var e={getCompletions:function(e,t,n,i,l){var r=t.getLine(n.row),s=/[A-Za-z_'\u03b1-\u03ba\u03bc-\u03fb\u1f00-\u1ffe\u2070-\u2079\u207f-\u2089\u2090-\u209c\u2100-\u214f\.]/;if(i=o.retrievePrecedingIdentifier(r,n.column,s),u=[],i.length>2){var u=completions.filter(function(e){return e.name.indexOf(i)>-1}),d=a.completer.popup;d&&(d.container.style.width=.8*window.innerWidth)}l(null,u)}};i.addCompleter(e)},init_input_method:function(){a.commands.on("afterExec",function(e){if("insertstring"===e.command.name&&(" "===e.args||"\\"===e.args)){var t=a.getCursorPosition(),n=a.session.getLine(t.row),o=" "===e.args?t.column-1:t.column-2,i=i=n.lastIndexOf("\\",o)+1,r=n.substring(i,t.column-1);if(i&&corrections.hasOwnProperty(r)){var s=corrections[r];"\\"===e.args&&(s+=e.args),a.session.replace(new l(t.row,i-1,t.row,t.column),s)}}})},load_from_code:function(){if(""!=p){"/"==p.substr(-1)&&(p=p.substr(0,p.length-1));var e=decodeURIComponent(escape(atob(p)));a.setValue(e,1)}},load_from_url:function(){g.indexOf("://github.com/")>-1?(g=g.replace("://github.com","://raw.githubusercontent.com"),g=g.replace("/blob/","/")):g.indexOf("://gist.github.com")&&(g=g.replace("://gist.github.com","://gist.githubusercontent.com"),g+="/raw"),$.ajaxPrefilter(function(e){if(e.crossDomain&&jQuery.support.cors){var t="http:"===window.location.protocol?"http:":"https:";e.url=t+"//cors-anywhere.herokuapp.com/"+e.url}}),$.get(g,function(e){myModule.editor_main.setValue(e,1)})},parse_lean_output_buffer:function(e){for(var t,n,o,i,a,l,r=0,s="outside",u=[];r<e.length;)line=e[r++],line.startsWith("FLYCHECK_BEGIN")?(s="flycheck",l=line.split(" ")[1].toLowerCase(),"information"==l&&(l="info"),line=e[r++],items=line.split(":"),filename=items[0],o=parseInt(items[1])-1,i=o+1,n=t=parseInt(items[2]),a=items.slice(3).join(":").trim()):line.startsWith("FLYCHECK_END")?(u.push({row:o,endRow:i,column:t,endColumn:n,text:a,type:l}),s="outside"):"outside"===s?this.append_console_nl(line):"flycheck"===s?a+="\n"+line:console.log("Something's wrong",line);return u},dropbox_show_username:function(){n.getAccountInfo(function(e,t){e?console.log("Dropbox GetAccountInfo",e):($("#signin-button").text(""),$("#username").text("Welcome "+t.name+"!"))})},dropbox_connect:function(){n.authenticate(function(e,t){e?console.log("Dropbox Connect Error",e):this.dropbox_show_username()})},dropbox_setup_button:function(){n.authenticate({interactive:!1},function(e,t){if(t.isAuthenticated())myModule.dropbox_show_username();else{var n=document.querySelector("#signin-button");n.addEventListener("click",function(){myModule.dropbox_connect()}),$("#signin-button").prepend('<img class="menu_icon" src="./images/dropbox.svg" title="signin"/>')}})},dropbox_load_file:function(e){var o=t+e;n.isAuthenticated()&&n.readFile(e,function(e,t){e?(myModule.append_console_nl("-- Could not read from '"+o+"'."),console.log("Dropbox Load File Error: ",e)):(a.setValue(t,1),a.focus(),myModule.append_console_nl("-- '"+o+"' loaded."))})},save_file:function(e,o){var i=t+e;n.isAuthenticated()?n.writeFile(e,o,function(e,t){myModule.append_console_nl(e?"-- Failed to write to '"+i+"'.":"-- Saved at '"+i+"'.")}):($.cookie("leanjs",myModule.editor_main.getValue()),myModule.append_console_nl("-- Saved at cookie."))},init_ace:function(){myModule.init_editor_main(),myModule.init_editor_console(),myModule.init_editor_keybindings(),myModule.init_resizable(),myModule.init_input_method(),myModule.init_autocomplete(),myModule.resize_editors(),window.onresize=function(e){myModule.resize_editors()}},scrollTutorialTo:function(e){setTimeout(function(){$("#tutorial_contents").ready(function(){$("#tutorial_contents").animate({scrollTop:$("#tutorial_contents").scrollTop()+$("#"+e).position().top},"slow")})},50)},file2title:function(e){return e.split("_").join(" ").replace(".html","")},title2file:function(e){return e.split(" ").join("_")+".html"},loadTutorial:function(e,t){$("#tutorial_contents").load(e,function(){t&&myModule.scrollTutorialTo(t),$.cookie("leanjs_tutorial_chapter_filename",e)}),$("#tutorialNav").val(myModule.file2title(e))},init_nav:function(){s?$("#tutorialNav").hide():$.getScript("js/nav_data.js",function(){$.each(lean_nav_data,function(e,t){var n=myModule.file2title(t);$("#tutorialNav").append("<option>"+n+"</option>")}),$("#tutorialNav").on("change",function(e){var t=myModule.title2file(this.value);myModule.loadTutorial(t,null)}),$("#tutorialNav").show();var e=$.cookie("leanjs_tutorial_chapter_filename");e&&""!=e&&$.inArray(e,lean_nav_data)?myModule.loadTutorial(e,null):myModule.loadTutorial(lean_nav_data[0],null)})},init:function(){myModule.init_nav(),this.append_console_nl("Lean.JS: running Lean Theorem Prover on your browser"),this.append_console("-- Initializing Ace Editor...     ");var e=(new Date).getTime();if(myModule.init_ace(),myModule.append_console("Done"),myModule.append_console_nl("("+elapsed_time_string(e)+")"),myModule.dropbox_setup_button(),""!=p)myModule.load_from_code();else if(""!=g)myModule.load_from_url();else if(myModule.get_dropbox_client().isAuthenticated())myModule.dropbox_load_file(f);else{var t=$.cookie("leanjs");t&&""!=t&&(myModule.editor_main.setValue(t,1),myModule.append_console_nl("-- Text loaded from cookie."))}},clear_console:function(){r.setValue("",1)},append_console:function(e){r.setValue(r.getValue()+e,1)},append_console_nl:function(e){this.append_console(e),this.append_console("\n")},init_lean:function(){var e=(new Date).getTime();myModule.append_console("-- Initializing Lean...           "),setTimeout(function(){Module.lean_init(),myModule.append_console("Done"),myModule.append_console_nl("("+elapsed_time_string(e)+")")},5)},import_module:function(e){var t=(new Date).getTime();myModule.append_console("-- Importing Module '"+e+"'... "),setTimeout(function(){Module.lean_import_module(e),myModule.append_console("Done"),myModule.append_console_nl("("+elapsed_time_string(t)+")"),myModule.append_console("-- Ready.\n")},5)},save_to_filesystem:function(e,t){FS.writeFile(e,t,{encoding:"utf8"})},process_main_buffer:function(){this.clear_console(),myModule.append_console_nl("-- Processing...");var e=(new Date).getTime();setTimeout(function(){myModule.save_to_filesystem(f,a.getValue()),myModule.save_file(f,a.getValue()),myModule.process_file(f),myModule.append_console("-- Done"),myModule.append_console_nl("("+elapsed_time_string(e)+")")},1)},process_file:function(e){_=[],a.session.clearAnnotations(),Module.lean_process_file(e);var t=this.parse_lean_output_buffer(_);a.session.setAnnotations(t)}}}();$(function(){var e=document.querySelector("#new-button");e.addEventListener("click",function(){myModule.editor_main.setValue("",1)})}),$(function(){var e=document.querySelector("#load-button");e.addEventListener("click",function(){if(myModule.get_dropbox_client().isAuthenticated()){var e={success:function(e){$.get(e[0].link,function(e){myModule.editor_main.setValue(e,1)}),myModule.append_console_nl("-- "+e[0].name+" is loaded from Dropbox.")},cancel:function(){},linkType:"direct",multiselect:!1,extensions:[".lean",".lua",".docx"]};Dropbox.choose(e)}})}),$(function(){var e=document.querySelector("#run-button");e.addEventListener("click",function(){myModule.process_main_buffer()})}),$(function(){var e=document.querySelector("#save-button");e.addEventListener("click",function(){myModule.save_file("input.lean",myModule.editor_main.getValue())})}),$(function(){var e=document.querySelector("#console-button");e.addEventListener("click",function(){myModule.set_main_console_ratio(myModule.get_main_console_ratio()<.8?1:.5),myModule.resize_editors()})}),$(function(){var e=document.querySelector("#share-button");e.addEventListener("click",function(){var e=window.location.href.split("?")[0],t=myModule.editor_main.getValue();if(""!=t){var n=btoa(unescape(encodeURIComponent(t))),o=e+"?code="+n;window.prompt("Copy to clipboard: Ctrl+C, Enter",o)}})}),myModule.init();var Module={};""!=gup("mem")?Module.TOTAL_MEMORY=1024*gup("mem")*1024:Module.TOTAL_MEMORY=67108864,Module.print=function(e){myModule.push_output_buffer(e),editor_main.focus()},Module.noExitRuntime=!0,Module.postRun=function(){myModule.init_lean(),setTimeout(function(){myModule.import_module("standard")},10)},Module.preRun=[];var lean_loading_start_time=(new Date).getTime();myModule.append_console("-- Loading lean.js...             "),Module.preRun.push(function(){myModule.append_console("Done"),myModule.append_console_nl("("+elapsed_time_string(lean_loading_start_time)+")")});
